<%- include('./pdfSubmissionheader')%>
<body>
    <div class="wrapper ">
        <div class="main-panel">
            <div class="summary">
                <div class="cont">
                    <div class="row">
                      <div class="col-md-4 col-sm-6">
                        <div class="card1 quiz-card3">
                          <h3>Max Plag</h3>
                          <div><p class="val"><%= maxPlag %>%</p></div>
                        </div>
                      </div>
                      <div class="col-md-4 col-sm-6">
                        <div class="card1 quiz-card3">
                          <h3>Tab Switch</h3>
                          <div><p class="val"><%= submission.browserSwitched %></p></div>
                        </div>
                      </div>
                      <div class="col-md-4 col-sm-6">
                        <div class="card1 quiz-card3">
                          <h3>Multi-Person</h3>
                          <div><p class="val"><%= submission.multiplePerson %></p></div>
                        </div>
                      </div>
                      <div class="col-md-4 col-sm-6">
                        <div class="card1 quiz-card3">
                          <h3>No person</h3>
                          <div><p class="val"><%= submission.noPerson %></p></div>
                        </div>
                      </div>
                      <div class="col-md-4 col-sm-6">
                        <div class="card1 quiz-card3">
                          <h3>Audio</h3>
                          <div><p class="val"><%= submission.audioDetected %></p></div>
                        </div>
                      </div>
                      <div class="col-md-4 col-sm-6">
                        <div class="card1 quiz-card3">
                          <h3>Mobile</h3>
                          <div><p class="val"><%= submission.mobileDetected %></p></div>
                        </div>
                      </div>
                      <div class="col-md-4 col-sm-6">
                        <div class="card1 quiz-card3">
                          <h3>Unique IP?</h3>
                          <div><p class="val"><%= unique %></p></div>
                        </div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="content cnt">
                <div class="container-fluid">
                    <div class="row" id="start">
                        <div class="col-lg-12 quiz">
                            <% for(let i=0; i<questionSubmissions.length; i++){ %>
                                <% if(questionSubmissions[i].mcq){ %>
                                    <div class="quiz-card">
                                        <div class="ques-ans" id="page02">
                                            <div class="question">
                                                <table class="qtable">
                                                    <tr>
                                                        <td class="quest">
                                                            <span class="que">Q</span><span class="question-number"><%= i+1 %>.</span> <%= questionSubmissions[i].question.question %>
                                                        </td>
                                                        <td class="marks">
                                                            <table class="marks-table">
                                                                <tr>
                                                                    <td>
                                                                        MM: <%= questionSubmissions[i].question.maximumMarks %>
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <td>
                                                                        <% if(questionSubmissions[i].checked){ %>
                                                                            <% if(questionSubmissions[i].marksObtained <= 0){ %>
                                                                                Marks: <span class="marks-assigned-zero"><%= questionSubmissions[i].marksObtained %></span>
                                                                            <% }else{ %>
                                                                                Marks: <span class="marks-assigned-positive"><%= questionSubmissions[i].marksObtained %></span>
                                                                            <% } %>
                                                                        <% }else{ %>
                                                                            <span class="marks-assigned-zero">Not Checked</span>
                                                                        <% } %> 
                                                                    </td>
                                                                </tr>
                                                            </table>
                                                        </td>
                                                    </tr>
                                                </table>
                                                <div style="text-align: center;">
                                                    <% for(let ic=0; ic<images[questionSubmissions[i]._id].length; ic++){ %>
                                                        <img class="questionImg" src="<%= images[questionSubmissions[i]._id][ic] %>" >
                                                    <% } %>
                                                </div>
                                            </div> <hr>
                                            <div class="answer1 checkbox">
                                                <% for(var j=0; j<questionSubmissions[i].question.options.length; j++){ %>
                                                    <label> 
                                                        <input type="checkbox" name="option1" value="option1" disabled 
                                                        <% if(questionSubmissions[i].optionsMarked.includes(questionSubmissions[i].question.options[j])){ %>
                                                            checked
                                                        <% } %>
                                                        ><i class="fa icon-checkbox"></i><span class="options"><%= questionSubmissions[i].question.options[j] %></span>
                                                        <% if(questionSubmissions[i].question.correctOptions.includes(questionSubmissions[i].question.options[j])){ %>
                                                            <i class="icon fa fa-check text-success fa-fw " title="Correct" aria-label="Correct"></i>
                                                        <% }else{ %>
                                                            <% if(questionSubmissions[i].optionsMarked.includes(questionSubmissions[i].question.options[j])){ %>
                                                                <i class="icon fa fa-remove text-danger fa-fw red" title="Incorrect" aria-label="Incorrect"></i>
                                                            <% } %>
                                                        <% } %>
                                                    </label><br>
                                                <% } %>
                                            </div>
                                        </div>
                                    </div>
                                <% }else{ %>
                                    <div class="quiz-card">
                                        <div class="ques-ans" id="page04">
                                            <div class="question">
                                                <table class="qtable">
                                                    <tr>
                                                        <td class="quest">
                                                            <span class="que">Q</span><span class="question-number"><%= i+1 %>.</span> <%= questionSubmissions[i].question.question %>
                                                        </td>
                                                        <td class="marks">
                                                            <table class="marks-table">
                                                                <tr>
                                                                    <td>
                                                                        MM: <%= questionSubmissions[i].question.maximumMarks %>
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <td>
                                                                        <% if(questionSubmissions[i].checked){ %>
                                                                            <% if(questionSubmissions[i].marksObtained <= 0){ %>
                                                                                Marks: <span class="marks-assigned-zero"><%= questionSubmissions[i].marksObtained %></span>
                                                                            <% }else{ %>
                                                                                Marks: <span class="marks-assigned-positive"><%= questionSubmissions[i].marksObtained %></span>
                                                                            <% } %>
                                                                        <% }else{ %>
                                                                            <span class="marks-assigned-zero">Not Checked</span>
                                                                        <% } %> 
                                                                    </td>
                                                                </tr>
                                                            </table>
                                                        </td>
                                                    </tr>
                                                </table>
                                                <div style="text-align: center;">
                                                    <% for(let ic=0; ic<images[questionSubmissions[i]._id].length; ic++){ %>
                                                        <img class="questionImg" src="<%= images[questionSubmissions[i]._id][ic] %>" >
                                                    <% } %>
                                                </div>
                                            </div> <hr>
                                            <div class="answer1">
                                                <div class="sub-answer"><%= questionSubmissions[i].textfield %></div>
                                            </div>
                                            <div class="panel-group">
                                                <div class="panel panel-default">
                                                    <div class="panel-heading">
                                                        <h4 class="panel-title">
                                                        <div data-toggle="collapse" href=<%= "#collapse2" + i %> onclick="page('<%= i %>')" >Similarity match from other students</div>
                                                        </h4>
                                                    </div>
                                                    <div id=<%= "collapse2" + i %> class="panel-collapse collapse cont1">  
                                                        <div class=<%= "container1" + i %>>
                                                            <div class="row" id="<%= 'row' + i %>">
                                                                <% questionSubmissions[i].studentPlagiarism.sort((a,b) => (a.percent > b.percent) ? -1 : 1).forEach(similarity => { %>
                                                                    <div class="col-lg-2 col-md-3 col-sm-4 col-xs-6 single-item1" data-bs-toggle="modal" data-bs-target=<%= "#modal" +String(questionSubmissions[i]._id+similarity.username.toUpperCase()) %>>
                                                                        <div class="btn plag-student-box"><%= similarity.username.toUpperCase() + " — " +similarity.percent*100 + "%" %> </div>
                                                                    </div>
                                                                    <div class="modal fade" id="modal<%= String(questionSubmissions[i]._id+similarity.username.toUpperCase()) %>" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                                        <div class="modal-dialog modal-dialog-scrollable-centered modal-lg" role="document">
                                                                            <div class="modal-content card">
                                                                              <div class="card-header card-header-green">
                                                                                <h4 class="modal-title">Similarity</h4>
                                                                              </div>
                                                                              <div class="modal-body">
                                                                                  <form action="#" method="POST" enctype="multipart/form-data">
                                                                                    <h5><b><%= submission.user.username.toUpperCase() %></b> (Current)</h5>
                                                                                    <div class="answer">
                                                                                        <div class="sub-answer"><%= questionSubmissions[i].textfield %></div>
                                                                                    </div> <br> <hr>
                                                                                    <h5>Answer similar with student <b><%= similarity.username.toUpperCase() %></b></h5>
                                                                                    <div class="answer">
                                                                                        <div class="sub-answer2"><%= similarity.text %></div>
                                                                                    </div>
                                                                                  </form>
                                                                              </div>
                                                                            </div>
                                                                          </div>
                                                                      </div>
                                                                <% }) %>
                                                            </div>
                                                            
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="panel-group">
                                                <div class="panel panel-default">
                                                    <div class="panel-heading">
                                                        <h4 class="panel-title">
                                                        <div data-toggle="collapse" href=<%= "#collapse1" + i %>>Plagarism percentage in answer : <%= questionSubmissions[i].webSource.plagiarismPercent %>%</div>
                                                        </h4>
                                                    </div>
                                                    <div id=<%= "collapse1" + i %> class="panel-collapse collapse">
                                                        <ul class="list-group">
                                                            <% for(var j=0; j<questionSubmissions[i].webSource.urls.length; j++){ %>
                                                                <li class="list-group-item"><a class="plag-links" target="_blank" href=<%= questionSubmissions[i].webSource.urls[j] %>><%= questionSubmissions[i].webSource.urls[j] %></a></li>
                                                            <% } %>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                <% } %>
                            <% } %>
                        </div>
                    </div>
                </div>
            </div>
        </div>
      </div>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
    <script src="./FacultyQuiz/js/script.js"></script>
</body>
</html>